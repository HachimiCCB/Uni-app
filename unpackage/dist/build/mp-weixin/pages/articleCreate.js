"use strict";const e=require("../common/vendor.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const a={__name:"articleCreate",setup(a){const t=e.ref(""),o=e.ref(""),l=e.ref([]),i=e.nr.database(),n=()=>{e.index.chooseImage({count:3-l.value.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{l.value=l.value.concat(e.tempFilePaths)}})},c=async()=>{if(o.value.trim()){e.index.showLoading({title:"提交中..."});try{const a=await Promise.all(l.value.map((async a=>(await e.nr.uploadFile({filePath:a,cloudPath:`article_${Date.now()}_${Math.random().toString(36).slice(2)}.jpg`})).fileID)));await i.collection("article").add({title:t.value,author:"客户端发文测试",content:o.value,coverImage:a[0]}),e.index.hideLoading(),e.index.showToast({title:"提交成功",icon:"success"}),o.value="",l.value=[]}catch(a){e.index.hideLoading(),e.index.showToast({title:"提交失败，请重试",icon:"none"}),console.error("提交错误:",a)}}else e.index.showToast({title:"请输入文章内容",icon:"none"})},s=()=>{o.value.trim()||l.value.length>0?e.index.showModal({title:"提示",content:"确定取消编辑吗？",success:e=>{e.confirm&&(o.value="",l.value=[])}}):e.index.navigateBack()};return(a,i)=>e.e({a:t.value,b:e.o((e=>t.value=e.detail.value)),c:o.value,d:e.o((e=>o.value=e.detail.value)),e:e.f(l.value,((a,t,o)=>({a:a,b:"39a3e506-0-"+o,c:e.o((a=>(a=>{e.index.showModal({title:"提示",content:"确定删除这张图片吗？",success:e=>{e.confirm&&l.value.splice(a,1)}})})(t)),t),d:t,e:e.o((a=>(a=>{e.index.previewImage({current:a,urls:l.value})})(t)),t)}))),f:e.p({type:"closeempty",size:"18",color:"#fff"}),g:l.value.length<3},l.value.length<3?{h:e.p({type:"plusempty",size:"40",color:"#8B5A2B"}),i:e.o(n)}:{},{j:e.o(c),k:!o.value.trim(),l:e.o(s)})}};wx.createPage(a);
