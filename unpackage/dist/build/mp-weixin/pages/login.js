"use strict";const e=require("../common/vendor.js");if(!Array){(e.resolveComponent("uv-notice-bar")+e.resolveComponent("uv-loading-page")+e.resolveComponent("uv-input")+e.resolveComponent("uv-modal")+e.resolveComponent("uv-toast"))()}Math||((()=>"../uni_modules/uv-notice-bar/components/uv-notice-bar/uv-notice-bar.js")+(()=>"../uni_modules/uv-loading-page/components/uv-loading-page/uv-loading-page.js")+(()=>"../uni_modules/uv-input/components/uv-input/uv-input.js")+o+(()=>"../uni_modules/uv-modal/components/uv-modal/uv-modal.js")+(()=>"../uni_modules/uv-toast/components/uv-toast/uv-toast.js"))();const o=()=>"../components/tab-bar/tabBar.js",a={__name:"login",setup(o){const a=e.ref("沟槽巫女说每注册一个用户就发三百金圆券当工资（真发吗？"),n=e.ref(!1),s=e.ref("login"),l=e.nr.database(),r=e.ref({username:"",password:""}),t=e.ref({username:"",password:"",confirmPwd:""}),u=e.ref(null),i=e.ref(null),d=e.ref(null),c=e=>{s.value=e},v=async()=>{if(r.value.username&&r.value.password){n.value=!0;try{(await l.collection("user").where({user_id:r.value.username,password:r.value.password}).get()).result.data.length>0?(e.index.showToast({title:"登录成功",icon:"success"}),e.index.setStorageSync("userInfo",{username:r.value.username,loggedIn:!0}),setTimeout((()=>{e.index.redirectTo({url:"/pages/setting"})}),1500)):e.index.showToast({title:"用户名或密码错误",icon:"none"})}catch(o){console.error("登录失败:",o),e.index.showToast({title:"登录失败，请重试",icon:"none"})}finally{n.value=!1}}else e.index.showToast({title:"请输入用户名和密码",icon:"none"})},p=async()=>{if(t.value.username&&t.value.password)if(t.value.password.length<6||t.value.password.length>20)e.index.showToast({title:"密码长度需在6-20位之间",icon:"none"});else if(t.value.password===t.value.confirmPwd){n.value=!0;try{if((await l.collection("user").where({user_id:t.value.username}).get()).result.data.length>0)return void e.index.showToast({title:"用户名已存在",icon:"none"});(await l.collection("user").add({user_id:t.value.username,password:t.value.password})).result.id&&(e.index.showToast({title:"注册成功",icon:"success"}),s.value="login",t.value={username:"",password:"",confirmPwd:""})}catch(o){console.error("注册失败:",o),e.index.showToast({title:"注册失败，请重试",icon:"none"})}finally{n.value=!1}}else e.index.showToast({title:"两次输入的密码不一致",icon:"none"});else e.index.showToast({title:"请输入用户名和密码",icon:"none"})},m=()=>{u.value.open()},w=()=>{i.value.open()};return(o,l)=>e.e({a:e.p({text:a.value,color:"#830000",bgColor:"#fbefcb"}),b:e.p({loading:n.value,"loading-text":"加载中...","font-size":"20px","loading-mode":"semicircle",bgColor:"#8D6549"}),c:e.n("login"===s.value?"active":""),d:e.o((e=>c("login"))),e:e.n("register"===s.value?"active":""),f:e.o((e=>c("register"))),g:"login"===s.value},"login"===s.value?{h:e.o((e=>r.value.username=e)),i:e.p({placeholder:"请输入用户名",border:"none",bgColor:"#fbefcb",modelValue:r.value.username}),j:e.o((e=>r.value.password=e)),k:e.p({type:"password",placeholder:"请输入密码",border:"none",bgColor:"#fbefcb",modelValue:r.value.password}),l:e.o(v),m:e.o(m),n:e.o(w)}:{o:e.o((e=>t.value.username=e)),p:e.p({placeholder:"设置用户名",border:"none",bgColor:"#fbefcb",modelValue:t.value.username}),q:e.o((e=>t.value.password=e)),r:e.p({type:"password",placeholder:"设置密码(6-20位)",border:"none",bgColor:"#fbefcb",modelValue:t.value.password}),s:e.o((e=>t.value.confirmPwd=e)),t:e.p({type:"password",placeholder:"确认密码",border:"none",bgColor:"#fbefcb",modelValue:t.value.confirmPwd}),v:e.o(p)},{w:e.p({selected:4}),x:e.p({placeholder:"请输入注册邮箱"}),y:e.sr(u,"33cd3f28-8",{k:"forgetModal"}),z:e.p({title:"找回密码",showCancelButton:!0}),A:e.sr(i,"33cd3f28-10",{k:"quickLoginModal"}),B:e.p({title:"快捷登录",showCancelButton:!0}),C:e.sr(d,"33cd3f28-11",{k:"toast"})})}},n=e._export_sfc(a,[["__scopeId","data-v-33cd3f28"]]);wx.createPage(n);
