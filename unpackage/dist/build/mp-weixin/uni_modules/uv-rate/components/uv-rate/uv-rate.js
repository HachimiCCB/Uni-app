"use strict";const t=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),e=require("../../../uv-ui-tools/libs/mixin/mixin.js"),i=require("./props.js"),a=require("../../../../common/vendor.js"),s={name:"uv-rate",mixins:[t.mpMixin,e.mixin,i.props],data:()=>({elId:"",elClass:"",rateBoxLeft:0,activeIndex:0,rateWidth:0,moving:!1}),watch:{value(t){this.activeIndex=t},modelValue(t){this.activeIndex=t}},created(){this.activeIndex=Number(this.value||this.modelValue),this.elId=this.$uv.guid(),this.elClass=this.$uv.guid()},mounted(){this.init()},methods:{init(){this.$uv.sleep(200).then((()=>{this.getRateItemRect(),this.getRateIconWrapRect()}))},async getRateItemRect(){await this.$uv.sleep(),this.$uvGetRect("#"+this.elId).then((t=>{this.rateBoxLeft=t.left}))},getRateIconWrapRect(){this.$uvGetRect("."+this.elClass).then((t=>{this.rateWidth=t.width}))},touchMove(t){if(!this.touchable)return;this.preventEvent(t);const e=t.changedTouches&&t.changedTouches[0].pageX||t.detail&&t.detail.pageX;this.getActiveIndex(e)},touchEnd(t){if(!this.touchable)return;this.preventEvent(t);const e=t.changedTouches&&t.changedTouches[0].pageX||t.detail&&t.detail.pageX;this.getActiveIndex(e)},clickHandler(t,e){if("ios"===this.$uv.os()&&this.moving)return;this.preventEvent(t);let i=0;i=t.changedTouches&&t.changedTouches[0].pageX||t.detail&&t.detail.pageX,this.getActiveIndex(i,!0)},changeEvent(){this.$emit("change",this.activeIndex),this.$emit("input",this.activeIndex),this.$emit("update:modelValue",this.activeIndex)},getActiveIndex(t,e=!1){if(this.disabled||this.readonly)return;const i=this.rateWidth*this.count+this.rateBoxLeft,a=t=this.$uv.range(this.rateBoxLeft,i,t)-this.rateBoxLeft;let s;if(this.allowHalf){s=Math.floor(a/this.rateWidth);const t=a%this.rateWidth;t<=this.rateWidth/2&&t>0?s+=.5:t>this.rateWidth/2&&s++}else{s=Math.floor(a/this.rateWidth);const t=a%this.rateWidth;e?t>0&&s++:t>this.rateWidth/2&&s++}this.activeIndex=Math.min(s,this.count),this.activeIndex<this.minCount&&(this.activeIndex=this.minCount),this.changeEvent(),setTimeout((()=>{this.moving=!0}),10),setTimeout((()=>{this.moving=!1}),10)}}};if(!Array){a.resolveComponent("uv-icon")()}Math;const n=a._export_sfc(s,[["render",function(t,e,i,s,n,h){return{a:a.f(Number(t.count),((e,i,s)=>a.e({a:"8a7d1d7f-0-"+s,b:a.p({name:Math.floor(n.activeIndex)>i?t.activeIcon:t.inactiveIcon,color:t.disabled?"#c8c9cc":Math.floor(n.activeIndex)>i?t.activeColor:t.inactiveColor,"custom-style":{"padding-left":t.$uv.addUnit(t.gutter/2),"padding-right":t.$uv.addUnit(t.gutter/2)},size:t.size}),c:a.o((t=>h.clickHandler(t,i+1)),i)},t.allowHalf?{d:"8a7d1d7f-1-"+s,e:a.p({name:Math.ceil(n.activeIndex)>i?t.activeIcon:t.inactiveIcon,color:t.disabled?"#c8c9cc":Math.ceil(n.activeIndex)>i?t.activeColor:t.inactiveColor,"custom-style":{"padding-left":t.$uv.addUnit(t.gutter/2),"padding-right":t.$uv.addUnit(t.gutter/2)},size:t.size}),f:a.o((t=>h.clickHandler(t,i+1)),i),g:a.s({width:t.$uv.addUnit(n.rateWidth/2)})}:{},{h:i}))),b:t.allowHalf,c:a.n(n.elClass),d:a.o(((...t)=>h.touchMove&&h.touchMove(...t))),e:a.o(((...t)=>h.touchEnd&&h.touchEnd(...t))),f:n.elId,g:a.s(t.$uv.addStyle(t.customStyle))}}],["__scopeId","data-v-8a7d1d7f"]]);wx.createComponent(n);
