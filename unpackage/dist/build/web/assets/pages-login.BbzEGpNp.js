import{r as e,_ as a,a as l,h as o,w as s,i as t,o as u,b as n,C as r,f as i,a1 as d,s as c,a7 as p,D as m,N as f}from"./index-yJ4PhItL.js";import{_ as v,b as _,a as b}from"./uv-loading-page.1lDLi1iZ.js";import{r as g}from"./uni-app.es.B94_6v_V.js";import{_ as h}from"./uv-input.BTDlQZCD.js";import{a as w}from"./uv-modal.Cp3Wc0LV.js";import{t as y}from"./tabBar.DlXmd0ww.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uv-icon.BQxwY_F2.js";import"./uv-icon.vue_vue_type_style_index_0_scoped_eab170a5_lang.DdJGWjg1.js";import"./uv-safe-bottom.gY7JiN5M.js";import"./uv-safe-bottom.vue_vue_type_style_index_0_scoped_71c4b1ce_lang.DIKD1uNm.js";import"./tabBar.vue_vue_type_style_index_0_scoped_8fa15eba_lang.CPwMltbA.js";const V=C({__name:"login",setup(C){const V=e("沟槽巫女说每注册一个用户就发三百金圆券当工资（真发吗？"),j=e(!1),k=e("login"),x=a.database(),P=e({username:"",password:""}),U=e({username:"",password:"",confirmPwd:""}),B=e(null),I=e(null),q=e(null),z=e=>{k.value=e},D=async()=>{if(P.value.username&&P.value.password){j.value=!0;try{(await x.collection("user").where({user_id:P.value.username,password:P.value.password}).get()).result.data.length>0?(d({title:"登录成功",icon:"success"}),c("userInfo",{username:P.value.username,loggedIn:!0}),setTimeout((()=>{p({url:"/pages/setting"})}),1500)):d({title:"用户名或密码错误",icon:"none"})}catch(e){console.error("登录失败:",e),d({title:"登录失败，请重试",icon:"none"})}finally{j.value=!1}}else d({title:"请输入用户名和密码",icon:"none"})},M=async()=>{if(U.value.username&&U.value.password)if(U.value.password.length<6||U.value.password.length>20)d({title:"密码长度需在6-20位之间",icon:"none"});else if(U.value.password===U.value.confirmPwd){j.value=!0;try{if((await x.collection("user").where({user_id:U.value.username}).get()).result.data.length>0)return void d({title:"用户名已存在",icon:"none"});(await x.collection("user").add({user_id:U.value.username,password:U.value.password})).result.id&&(d({title:"注册成功",icon:"success"}),k.value="login",U.value={username:"",password:"",confirmPwd:""})}catch(e){console.error("注册失败:",e),d({title:"注册失败，请重试",icon:"none"})}finally{j.value=!1}}else d({title:"两次输入的密码不一致",icon:"none"});else d({title:"请输入用户名和密码",icon:"none"})},N=()=>{B.value.open()},L=()=>{I.value.open()};return(e,a)=>{const d=g(l("uv-notice-bar"),v),c=g(l("uv-loading-page"),_),p=m,C=t,x=g(l("uv-input"),h),T=f,A=g(l("uv-modal"),w),E=g(l("uv-toast"),b);return u(),o(C,{class:"auth-container"},{default:s((()=>[n(d,{text:V.value,color:"#830000",bgColor:"#fbefcb"},null,8,["text"]),n(c,{loading:j.value,"loading-text":"加载中...","font-size":"20px","loading-mode":"semicircle",bgColor:"#8D6549"},null,8,["loading"]),n(C,{class:"auth-box"},{default:s((()=>[n(C,{class:"auth-tabs"},{default:s((()=>[n(p,{class:r(["tab-item","login"===k.value?"active":""]),onClick:a[0]||(a[0]=e=>z("login"))},{default:s((()=>[i("登录")])),_:1},8,["class"]),n(p,{class:r(["tab-item","register"===k.value?"active":""]),onClick:a[1]||(a[1]=e=>z("register"))},{default:s((()=>[i("注册")])),_:1},8,["class"])])),_:1}),"login"===k.value?(u(),o(C,{key:0,class:"auth-form"},{default:s((()=>[n(x,{modelValue:P.value.username,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value.username=e),placeholder:"请输入用户名",border:"none",bgColor:"#fbefcb",class:"auth-input"},null,8,["modelValue"]),n(x,{modelValue:P.value.password,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value.password=e),type:"password",placeholder:"请输入密码",border:"none",bgColor:"#fbefcb",class:"auth-input"},null,8,["modelValue"]),n(T,{onClick:D,class:"auth-btn"},{default:s((()=>[i("登录")])),_:1}),n(C,{class:"auth-extra"},{default:s((()=>[n(p,{onClick:N},{default:s((()=>[i("忘记密码?")])),_:1}),n(p,{onClick:L},{default:s((()=>[i("快捷登录")])),_:1})])),_:1})])),_:1})):(u(),o(C,{key:1,class:"auth-form"},{default:s((()=>[n(x,{modelValue:U.value.username,"onUpdate:modelValue":a[4]||(a[4]=e=>U.value.username=e),placeholder:"设置用户名",border:"none",bgColor:"#fbefcb",class:"auth-input"},null,8,["modelValue"]),n(x,{modelValue:U.value.password,"onUpdate:modelValue":a[5]||(a[5]=e=>U.value.password=e),type:"password",placeholder:"设置密码(6-20位)",border:"none",bgColor:"#fbefcb",class:"auth-input"},null,8,["modelValue"]),n(x,{modelValue:U.value.confirmPwd,"onUpdate:modelValue":a[6]||(a[6]=e=>U.value.confirmPwd=e),type:"password",placeholder:"确认密码",border:"none",bgColor:"#fbefcb",class:"auth-input"},null,8,["modelValue"]),n(T,{onClick:M,class:"auth-btn"},{default:s((()=>[i("注册")])),_:1})])),_:1}))])),_:1}),n(y,{selected:4}),n(A,{ref_key:"forgetModal",ref:B,title:"找回密码",showCancelButton:!0},{default:s((()=>[n(x,{placeholder:"请输入注册邮箱"})])),_:1},512),n(A,{ref_key:"quickLoginModal",ref:I,title:"快捷登录",showCancelButton:!0},{default:s((()=>[n(T,{"open-type":"getPhoneNumber"},{default:s((()=>[i("微信一键登录")])),_:1})])),_:1},512),n(E,{ref_key:"toast",ref:q},null,512)])),_:1})}}},[["__scopeId","data-v-d9c3895c"]]);export{V as default};
