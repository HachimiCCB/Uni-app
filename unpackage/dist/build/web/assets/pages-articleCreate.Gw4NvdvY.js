import{r as e,_ as a,g as l,a4 as s,a7 as t,a as u,h as o,w as c,i as n,o as i,b as r,c as d,k as p,F as m,f as v,j as f,a0 as _,a1 as h,a2 as g,a3 as y,H as b,a5 as k,D as C,L as V,N as w,G as j,t as x,a6 as D,E as I}from"./index-yJ4PhItL.js";import{_ as U}from"./uni-icons.n_uTH-bD.js";import{r as F}from"./uni-app.es.B94_6v_V.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=P({__name:"articleCreate",setup(P){const z=e(""),T=e(""),B=e([]),$=e(""),A=a.database(),E=l("userInfo");E&&E.loggedIn?console.log("当前登录用户：",E.username):s({title:"提示",content:"请先登录",showCancel:!1,confirmText:"确定",success:()=>{t({url:"/pages/setting"})}});const G=()=>{_({count:3-B.value.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{B.value=B.value.concat(e.tempFilePaths)}})},H=e([]),L=e(""),M=()=>{L.value.trim()&&!H.value.includes(L.value.trim())?(H.value.push(L.value.trim()),L.value=""):h({title:"标签重复或为空",icon:"none"})},N=async()=>{let e=$.value.trim();if(!e){e=T.value.split("\n").filter((e=>e.trim())).slice(0,2).join(" ")}if(T.value.trim()){g({title:"提交中..."});try{const l=await Promise.all(B.value.map((async e=>(await a.uploadFile({filePath:e,cloudPath:`article_${Date.now()}_${Math.random().toString(36).slice(2)}.jpg`})).fileID)));await A.collection("article").add({title:z.value,author:E.username,content:T.value,summary:e,coverImage:l[0],images:l,publishDate:new Date,lastUpdated:new Date,tags:H.value}),y(),h({title:"提交成功",icon:"success"}),z.value="",$.value="",H.value=[],T.value="",B.value=[]}catch(l){y(),h({title:"提交失败，请重试",icon:"none"}),console.error("提交错误:",l)}}else h({title:"请输入文章内容",icon:"none"})},S=()=>{T.value.trim()||B.value.length>0?s({title:"提示",content:"确定取消编辑吗？",success:e=>{e.confirm&&(T.value="",B.value=[])}}):b()};return(e,a)=>{const l=k,t=I,_=F(u("uni-icons"),U),h=n,g=C,y=V,b=w;return i(),o(h,{class:"container"},{default:c((()=>[r(l,{modelValue:z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),placeholder:"请输入标题",class:"titlearea","placeholder-class":"placeholder-style"},null,8,["modelValue"]),r(l,{modelValue:T.value,"onUpdate:modelValue":a[1]||(a[1]=e=>T.value=e),placeholder:"请输入文章内容",class:"textarea","placeholder-class":"placeholder-style"},null,8,["modelValue"]),r(l,{modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=e=>$.value=e),placeholder:"请输入文章简介（可选）",class:"titlearea","placeholder-class":"placeholder-style"},null,8,["modelValue"]),r(h,{class:"upload-area"},{default:c((()=>[(i(!0),d(m,null,p(B.value,((e,a)=>(i(),o(h,{class:"upload-item",key:a,onClick:e=>(e=>{D({current:e,urls:B.value})})(a)},{default:c((()=>[r(t,{src:e,class:"uploaded-image",mode:"aspectFill"},null,8,["src"]),r(h,{class:"delete-icon",onClick:j((e=>(e=>{s({title:"提示",content:"确定删除这张图片吗？",success:a=>{a.confirm&&B.value.splice(e,1)}})})(a)),["stop"])},{default:c((()=>[r(_,{type:"closeempty",size:"18",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1032,["onClick"])))),128)),B.value.length<3?(i(),o(h,{key:0,class:"upload-btn",onClick:G},{default:c((()=>[r(_,{type:"plusempty",size:"40",color:"#8B5A2B"}),r(g,{class:"upload-tip"},{default:c((()=>[v("最多3张")])),_:1})])),_:1})):f("",!0)])),_:1}),r(h,{class:"tag-area"},{default:c((()=>[r(h,{class:"tag-input-box"},{default:c((()=>[r(y,{modelValue:L.value,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value=e),class:"tag-input",placeholder:"输入标签后点击 + 添加"},null,8,["modelValue"]),r(b,{class:"add-tag-btn",onClick:M},{default:c((()=>[v("+")])),_:1})])),_:1}),r(h,{class:"tag-list"},{default:c((()=>[(i(!0),d(m,null,p(H.value,((e,a)=>(i(),o(h,{class:"tag-item",key:a},{default:c((()=>[r(g,null,{default:c((()=>[v(x(e),1)])),_:2},1024),r(g,{class:"remove-tag",onClick:e=>(e=>{H.value.splice(e,1)})(a)},{default:c((()=>[v("×")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})])),_:1}),r(h,{class:"button-group"},{default:c((()=>[r(b,{type:"default",onClick:N,disabled:!T.value.trim(),class:"submit-btn"},{default:c((()=>[v("提交")])),_:1},8,["disabled"]),r(b,{type:"default",onClick:S,class:"cancel-btn"},{default:c((()=>[v("取消")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a58c31bd"]]);export{z as default};
